//document.addEventListener("click", function (e) {
//    const toggle = e.target.closest(".nav-group-toggle");
//    if (!toggle) return;

//    const group = toggle.closest(".nav-group");
//    group.classList.toggle("open");
//});
// ============================================================
// FUNCIÓN PARA TOGGLE DEL SIDEBAR (responsive)
// ============================================================
function toggleSidebar() {
    document.querySelector('.layout-wrapper').classList.toggle('sidebar-collapsed');
}

// ============================================================
// COMPORTAMIENTO DE ACORDEÓN PARA EL MENÚ
// Solo permite un submenú abierto a la vez
// ============================================================
document.addEventListener("DOMContentLoaded", function () {

    console.log("✅ JavaScript cargado correctamente");

    // Obtener todos los toggles de grupos
    const toggles = document.querySelectorAll(".nav-group-toggle");

    console.log(`📋 Encontrados ${toggles.length} grupos de menú`);

    toggles.forEach((toggle, index) => {
        toggle.addEventListener("click", function (e) {
            e.preventDefault();
            e.stopPropagation();

            console.log(`🖱️ Clic en grupo ${index + 1}`);

            const parentGroup = this.closest(".nav-group");
            const wasOpen = parentGroup.classList.contains("open");

            console.log(`Estado anterior: ${wasOpen ? 'ABIERTO' : 'CERRADO'}`);

            // ⭐ CERRAR TODOS LOS GRUPOS PRIMERO ⭐
            document.querySelectorAll(".nav-group").forEach(group => {
                if (group !== parentGroup) {
                    group.classList.remove("open");
                    console.log("🔒 Cerrando otro grupo");
                }
            });

            // ⭐ SI NO ESTABA ABIERTO, ABRIRLO ⭐
            if (!wasOpen) {
                parentGroup.classList.add("open");
                console.log("🔓 Abriendo este grupo");

                // ⭐ AUTO-SCROLL: Hacer scroll para que el menú padre quede visible en la parte superior ⭐
                setTimeout(() => {
                    const sidebarNav = document.querySelector('.sidebar-nav');
                    if (sidebarNav) {
                        // Obtener posiciones
                        const groupRect = parentGroup.getBoundingClientRect();
                        const sidebarRect = sidebarNav.getBoundingClientRect();
                        const subMenu = parentGroup.querySelector('.nav-group-items');

                        // Calcular si el menú expandido cabe en el área visible
                        const totalHeight = groupRect.height + (subMenu ? subMenu.scrollHeight : 0);
                        const availableSpace = sidebarRect.bottom - groupRect.top;

                        // Solo hacer scroll si no cabe completamente
                        if (totalHeight > availableSpace) {
                            // Hacer scroll para que el PADRE quede cerca del TOP del sidebar
                            // pero dejando un margen de 80px desde el top para que se vea el header
                            const scrollTarget = parentGroup.offsetTop - 80;

                            sidebarNav.scrollTo({
                                top: scrollTarget,
                                behavior: 'smooth'
                            });
                            console.log(`📜 Auto-scroll: menú padre a posición ${scrollTarget}px`);
                        }
                    }
                }, 100); // Delay para que la animación CSS termine
            } else {
                parentGroup.classList.remove("open");
                console.log("🔒 Cerrando este grupo");
            }
        });
    });

    // ⭐ AUTO-SCROLL EN CARGA INICIAL: Si hay un menú activo expandido, hacer scroll ⭐
    setTimeout(() => {
        const activeItem = document.querySelector('.nav-group.open .nav-link.active');
        if (activeItem) {
            const sidebarNav = document.querySelector('.sidebar-nav');
            if (sidebarNav) {
                activeItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
                console.log("📜 Auto-scroll inicial al menú activo");
            }
        }
    }, 100);
});