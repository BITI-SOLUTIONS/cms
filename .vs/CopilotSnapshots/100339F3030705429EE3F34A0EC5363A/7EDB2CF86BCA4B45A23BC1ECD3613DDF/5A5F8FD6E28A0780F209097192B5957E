// ================================================================================
// ARCHIVO: CMS.Application/DTOs/UserDtos.cs
// PROPÓSITO: DTOs compartidos para transferencia de datos de Usuarios entre API y UI
// AUTOR: System CMS - BITI Solutions S.A
// CREADO: 2024
// ================================================================================

namespace CMS.Application.DTOs
{
    /// <summary>
    /// DTO para listar usuarios en tablas y grids.
    /// Incluye información resumida del usuario con sus roles asignados.
    /// </summary>
    public class UserListDto
    {
        /// <summary>ID único del usuario en la base de datos</summary>
        public int Id { get; set; }

        /// <summary>Nombre de usuario único para autenticación</summary>
        public string Username { get; set; } = default!;

        /// <summary>Correo electrónico del usuario (único)</summary>
        public string Email { get; set; } = default!;

        /// <summary>Nombre completo o alias para mostrar en la UI</summary>
        public string? DisplayName { get; set; }

        /// <summary>Indica si el usuario está activo en el sistema</summary>
        public bool IsActive { get; set; }

        /// <summary>Indica si el email está verificado</summary>
        public bool IsEmailVerified { get; set; }

        /// <summary>Fecha de creación del registro</summary>
        public DateTime CreateDate { get; set; }

        /// <summary>Fecha del último inicio de sesión</summary>
        public DateTime? LastLogin { get; set; }

        /// <summary>Lista de nombres de roles asignados al usuario</summary>
        public List<string> Roles { get; set; } = new();
    }

    /// <summary>
    /// DTO para visualizar detalles completos de un usuario.
    /// Incluye roles, permisos directos y datos de Azure AD.
    /// </summary>
    public class UserDetailDto
    {
        /// <summary>ID único del usuario</summary>
        public int Id { get; set; }

        /// <summary>Nombre de usuario</summary>
        public string Username { get; set; } = default!;

        /// <summary>Correo electrónico</summary>
        public string Email { get; set; } = default!;

        /// <summary>Nombre para mostrar</summary>
        public string? DisplayName { get; set; }

        /// <summary>Object ID de Azure AD (si está sincronizado)</summary>
        public Guid? AzureOid { get; set; }

        /// <summary>User Principal Name de Azure AD</summary>
        public string? AzureUpn { get; set; }

        /// <summary>Estado activo/inactivo</summary>
        public bool IsActive { get; set; }

        /// <summary>Email verificado</summary>
        public bool IsEmailVerified { get; set; }

        /// <summary>Fecha de creación</summary>
        public DateTime CreateDate { get; set; }

        /// <summary>Usuario que creó el registro</summary>
        public string CreatedBy { get; set; } = default!;

        /// <summary>Primer nombre</summary>
        public string? FirstName { get; set; }

        /// <summary>Apellido</summary>
        public string? LastName { get; set; }

        /// <summary>Número de teléfono</summary>
        public string? PhoneNumber { get; set; }

        /// <summary>Fecha de nacimiento</summary>
        public DateTime? DateOfBirth { get; set; }

        /// <summary>ID del país</summary>
        public int IdCountry { get; set; }

        /// <summary>ID del género</summary>
        public int IdGender { get; set; }

        /// <summary>Zona horaria</summary>
        public string? TimeZone { get; set; }

        /// <summary>Roles asignados al usuario</summary>
        public List<RoleSimpleDto> Roles { get; set; } = new();

        /// <summary>Permisos asignados directamente (sin roles)</summary>
        public List<PermissionSimpleDto> DirectPermissions { get; set; } = new();

        /// <summary>Compañías a las que tiene acceso el usuario</summary>
        public List<UserCompanySimpleDto> Companies { get; set; } = new();
    }

    /// <summary>
    /// DTO para crear un nuevo usuario.
    /// No incluye ID porque es auto-generado.
    /// </summary>
    public class UserCreateDto
    {
        /// <summary>Nombre de usuario (obligatorio, único)</summary>
        public string Username { get; set; } = default!;

        /// <summary>Email (obligatorio, único)</summary>
        public string Email { get; set; } = default!;

        /// <summary>Nombre para mostrar (opcional)</summary>
        public string? DisplayName { get; set; }

        /// <summary>Hash de contraseña (opcional, para usuarios locales)</summary>
        public string? PasswordHash { get; set; }

        /// <summary>Contraseña en texto plano (será hasheada)</summary>
        public string? Password { get; set; }

        /// <summary>Estado inicial del usuario (default: true)</summary>
        public bool IsActive { get; set; } = true;

        /// <summary>Primer nombre</summary>
        public string FirstName { get; set; } = "User";

        /// <summary>Apellido</summary>
        public string LastName { get; set; } = "System";

        /// <summary>Número de teléfono</summary>
        public string? PhoneNumber { get; set; }

        /// <summary>ID del país</summary>
        public int IdCountry { get; set; } = 52; // Costa Rica por defecto

        /// <summary>ID del género</summary>
        public int IdGender { get; set; } = 1; // Masculino por defecto

        /// <summary>Zona horaria</summary>
        public string TimeZone { get; set; } = "America/Costa_Rica";

        /// <summary>Fecha de nacimiento</summary>
        public DateTime? DateOfBirth { get; set; }

        /// <summary>IDs de roles a asignar (se asignarán en todas las compañías especificadas)</summary>
        public List<int>? RoleIds { get; set; }

        /// <summary>IDs de compañías a las que tendrá acceso el usuario</summary>
        public List<int>? CompanyIds { get; set; }

        /// <summary>Email verificado</summary>
        public bool IsEmailVerified { get; set; }
    }

    /// <summary>
    /// DTO para actualizar un usuario existente.
    /// Solo incluye campos modificables.
    /// </summary>
    public class UserUpdateDto
    {
        /// <summary>Nombre para mostrar</summary>
        public string? DisplayName { get; set; }

        /// <summary>Nuevo email (si cambia, debe ser único)</summary>
        public string? Email { get; set; }

        /// <summary>Estado activo/inactivo</summary>
        public bool IsActive { get; set; }

        /// <summary>Email verificado</summary>
        public bool IsEmailVerified { get; set; }

        /// <summary>Primer nombre</summary>
        public string? FirstName { get; set; }

        /// <summary>Apellido</summary>
        public string? LastName { get; set; }

        /// <summary>Número de teléfono</summary>
        public string? PhoneNumber { get; set; }

        /// <summary>Fecha de nacimiento</summary>
        public DateTime? DateOfBirth { get; set; }

        /// <summary>ID del país</summary>
        public int IdCountry { get; set; }

        /// <summary>ID del género</summary>
        public int IdGender { get; set; }

        /// <summary>Zona horaria</summary>
        public string? TimeZone { get; set; }

        /// <summary>IDs de roles a asignar</summary>
        public List<int>? RoleIds { get; set; }
    }

    /// <summary>
    /// DTO simplificado de usuario para mostrar en listas relacionadas.
    /// Ejemplo: usuarios asignados a un rol.
    /// </summary>
    public class UserSimpleDto
    {
        /// <summary>ID del usuario</summary>
        public int Id { get; set; }

        /// <summary>Nombre de usuario</summary>
        public string Username { get; set; } = default!;

        /// <summary>Email del usuario</summary>
        public string Email { get; set; } = default!;
    }

    /// <summary>
    /// DTO simplificado de compañía para mostrar en la lista de compañías del usuario
    /// </summary>
    public class UserCompanySimpleDto
    {
        /// <summary>ID de la compañía</summary>
        public int CompanyId { get; set; }

        /// <summary>Nombre de la compañía</summary>
        public string CompanyName { get; set; } = default!;

        /// <summary>Indica si es la compañía por defecto del usuario</summary>
        public bool IsDefault { get; set; }

        /// <summary>Indica si el acceso está activo</summary>
        public bool IsActive { get; set; }
    }
}